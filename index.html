<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cinzel', serif;
  background:#000;
  color:#e0e0e0;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}

.system-banner{
  text-align:center;
  color:#777;
  font-size:11px;
  letter-spacing:1.5px;
  padding-bottom:6px;
  margin-bottom:10px;
  text-transform:uppercase;
}

/* MATRIX */
#matrix{
  position:fixed;
  inset:0;
  z-index:-1;
}

.container{ text-align:center; }

/* LOGIN */
.title{
  font-size:20px;
  letter-spacing:3px;
  margin-bottom:18px;
}

.title span{
  transition: font-size 0.6s ease, color 0.6s ease;
}

input{
  width:240px;
  padding:12px;
  background:#000;
  border:none;
  border-bottom:2px solid #555;
  color:#e0e0e0;
  font-size:16px;
  text-align:center;
}

button{
  background:#111;
  border:1px solid #444;
  color:#e0e0e0;
  cursor:pointer;
}

/* LOADING */
#loading{ display:none; }

.loader{
  width:50px;
  height:50px;
  border:3px solid #222;
  border-top:3px solid #7aff7a;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto;
}

@keyframes spin{ to{transform:rotate(360deg);} }

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  50% { transform: translateX(3px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

/* CHAT */
#content{ display:none; }

.terminal{
  width:600px;
  background:#050505;
  border:1px solid #222;
  padding:15px;
}

/* PROFILE HEADER */
.profile{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
  position:relative;
}

.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#333;
  position:relative;
}

.avatar::before{
  content:"";
  position:absolute;
  top:6px;
  left:50%;
  width:12px;
  height:12px;
  background:#555;
  border-radius:50%;
  transform:translateX(-50%);
}

.avatar::after{
  content:"";
  position:absolute;
  bottom:6px;
  left:50%;
  width:18px;
  height:10px;
  background:#555;
  border-radius:10px 10px 4px 4px;
  transform:translateX(-50%);
}

.profile-info{
  display:flex;
  flex-direction:column;
}

.username{
  font-size:14px;
  color:#7aff7a;
}

.status{
  font-size:11px;
}

.online{ color:#7aff7a; }
.offline{ color:#a33; }

.counter{
  position:absolute;
  top:0;
  right:0;
  font-size:14px;
  color:#7aff7a;
  letter-spacing:1px;
}

/* CHAT AREA */
#chat{
  height:300px;
  background:#000;
  padding:10px;
  border:1px solid #111;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
}
#chat,
.fake-input,
.message {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  letter-spacing: 0.4px;
}

#chat,
.message,
.fake-input {
  text-transform: uppercase;
}

#chat,
.message,
.fake-input {
  font-family: 'Roboto Mono', monospace;
  font-size: 13px;
  letter-spacing: 0.5px;
}

.message{ margin-bottom:10px; max-width:80%; display: inline-block; align-self: flex-start; }
.user{ align-self:flex-end; color:#fff; }
.bot{ align-self:flex-start; color:#7aff7a; text-shadow: 0 0 6px rgba(122,255,122,0.25); text-align: left; }
.system{ color:#666; font-style:normal; text-align:center; width:100%; margin:12px 0; letter-spacing:1px; }
.typing{ opacity:.6; font-style:italic; }

/* INPUT */
.input-area{
  display:flex;
  align-items:center;
  gap:6px;
  margin-top:10px;
}

.fake-input{
  flex:1;
  height:24px;
  padding:4px 8px;
  line-height:16px;
  background:#000;
  border:1px solid #333;
  color:#fff;
}

.fake-input:empty:before{
  content:attr(data-placeholder);
  color:#666;
}

.sendBtn{
  width:50px;
  height:50px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:20px;
  color:#7aff7a;
  background:#111;
  border:1px solid #333;
}

/* EXIT */
#exitFloating{
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #a33;
  border: 1px solid #600;
  color: #fff;
  padding: 10px 16px;
  font-family: 'JetBrains Mono', monospace;
  letter-spacing: 1px;
  cursor: pointer;
  z-index: 999;
}

#exitFloating:hover{
  background:#c44;
}

#exitModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:center;
}

.modalBox{
  background:#000;
  border:1px solid #a33;
  padding:35px 45px;
  text-align:center;
}

/* ===== SCROLLBAR (DARK) ===== */
#chat::-webkit-scrollbar {
  width: 6px;
}

#chat::-webkit-scrollbar-track {
  background: #000;
}

#chat::-webkit-scrollbar-thumb {
  background: #222;
  border-radius: 4px;
}

#chat::-webkit-scrollbar-thumb:hover {
  background: #444;
}

#chat {
  scrollbar-width: thin;
  scrollbar-color: #222 #000;
}

</style>
</head>

<body>

<canvas id="matrix"></canvas>

<div class="container">

<!-- LOGIN -->
<div id="login">

  <h1 class="title">
  <span id="riddleText" style="font-size:18px; letter-spacing:1px; color:#ccc;">
    Bazı cevaplar sınırların dışındadır
  </span>
</h1>

  <input type="password" id="password"
         onkeydown="if(event.key==='Enter') checkPassword()">
  <br><br>
  <button onclick="checkPassword()">GO</button>

 <div id="loginError" style="
   margin-top:10px;
   font-size:20px;
   color:#a33;
   letter-spacing:1px;
   display:none;
 ">
   YANLIŞ
 </div>
</div>

<!-- LOADING -->
<div id="loading">
  <div class="loader"></div>
  <p>CONNECTING...</p>
</div>

<!-- CHAT -->
<div id="content">
  <div class="terminal">

    <div class="profile">
      <div class="avatar"></div>
      <div class="profile-info">
        <div class="username">@ROE</div>
        <div id="status" class="status offline">● offline</div>
      </div>
    <div id="counter" class="counter">10/10</div>
    </div>

    <div id="chat">
      <div class="system-banner">VPN AKTİFLEŞTİRİLDİ</div>
      <div class="message bot typing" id="typing" style="display:none;">typing...</div>
    </div>

    <div class="input-area">
  <div id="userInput" class="fake-input" contenteditable="true"
       data-placeholder="mesaj yaz"
       onkeydown="if(event.key==='Enter'){event.preventDefault();unlockSound();sendMessage();}">
  </div>
  <button id="sendBtn" onclick="unlockSound(); sendMessage()">➤</button>
</div>

  </div>
</div>

</div>

<button id="exitFloating">EXIT</button>

<div id="exitModal">
  <div class="modalBox">
    <p>Bir kez çıkış yaparsan tekrar bağlanamazsın.</p>

    <div style="display:flex; gap:10px; justify-content:center;">
      <button id="confirmExit">EXIT</button>
      <button id="cancelExit">CANCEL</button>
    </div>
  </div>
</div>

<script>
let wrongPasswordCount = 0;
let currentRiddleLevel = 0;
let connectionClosed = false;
let botQueue = [];
let botBusy = false;
let soundUnlocked = false;
let userMessageCount = 0;
let conversationTurn = 0;
let botIsSpeaking = false;

function normalizeText(text) {
  return text
    .toLowerCase()
    .replace(/ı/g, "i")
    .replace(/i̇/g, "i")
    .replace(/ş/g, "s")
    .replace(/ğ/g, "g")
    .replace(/ü/g, "u")
    .replace(/ö/g, "o")
    .replace(/ç/g, "c")
    .replace(/[^a-z0-9\s]/g, "")
    .trim();
}

function hasAny(text, words) {
  const t = normalizeText(text);
  return words.some(w => t.includes(normalizeText(w)));
}

function hasAll(text, words) {
  const t = normalizeText(text);
  return words.every(w => t.includes(normalizeText(w)));
}

function runSequence(sequence) {
  botIsSpeaking = true;
  let stepIndex = 0;

  function nextStep() {
    if (stepIndex >= sequence.length) {
      botIsSpeaking = false;
      endOfTurn();
      return;
    }

    const step = sequence[stepIndex];
    const text = step[Math.floor(Math.random() * step.length)];

    typingEl.style.display = "block";
    chat.scrollTop = chat.scrollHeight;

    setTimeout(() => {
      typingEl.style.display = "none";
      addMessage(text, "bot");
      playBotSound();

      stepIndex++;

      setTimeout(() => {
        nextStep();
      }, rand(1500, 2400));

    }, rand(1800, 2800));
  }

  nextStep();
}

function updateCounter(){
  const remaining = MAX_MESSAGES - userMessageCount;
  counterEl.textContent = remaining + "/" + MAX_MESSAGES;

  if (remaining <= 2) {
    counterEl.style.color = "#a33"; // kırmızı
  } else {
    counterEl.style.color = "#7aff7a"; // yeşil
  } 
}

const riddleSizes = {
  0: "20px",
  3: "26px",
  5: "30px",
  8: "45px"
};

const riddles = {
  0: "Bazı cevaplar sınırların dışındadır",

  3: "Kim gitmeyeceği bir randevuyu alır ki?",

  5: "Bir isim ve bir numara sana tarihi verir",

  8: "Alpa'ya sor!"
};

function unlockSound() {
  if (soundUnlocked) return;

  userSound.muted = true;
  userSound.play().then(() => {
    userSound.pause();
    userSound.currentTime = 0;
    userSound.muted = false;
  }).catch(()=>{});

  botSound.muted = true;
  botSound.play().then(() => {
    botSound.pause();
    botSound.currentTime = 0;
    botSound.muted = false;
  }).catch(()=>{});

  soundUnlocked = true;
}

function playUserSound() {
  if (!soundUnlocked) return;

  setTimeout(() => {
    userSound.currentTime = 0;
    userSound.play().catch(()=>{});
  }, 80);
}

function playBotSound() {
  if (!soundUnlocked) return;

  setTimeout(() => {
    botSound.currentTime = 0;
    botSound.play().catch(()=>{});
  }, 120);
}

const correctPasswords = [
  "18122025",
  "181225",
  "121825",
  "12182025"
];

const messageTriggers = {};
const MAX_MESSAGES = 10;
const counterEl = document.getElementById("counter");
const EXIT_KEY = "roe_exit_time";
const confirmExit = document.getElementById("confirmExit");
const cancelExit = document.getElementById("cancelExit");

const farewellMessages = [
  "bundan sonrası sende dostum",
  "benden bu kadar gerisi sende",
  "artık tek başınasın iyi şanslar",
];

exitFloating.onclick = () => {
  exitModal.style.display = "flex";
};

confirmExit.onclick = () => {

  document.body.innerHTML = `
    <div style="
      background:#000;
      color:#777;
      font-family:'Cinzel', serif;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    ">
      <p>bağlantı kesildi.</p>
    </div>
  `;
};

cancelExit.onclick = () => {
  exitModal.style.display = "none";
};

/* ===== DIALOG ENGINE ===== */
const dialogRules = [
  {
    hasAny: ["merhaba", "selam", "hey", "selamınaleyküm", "meraba"],
    replies: [
      "Sonunda. Hiç çözemeyeceksiniz diye düşünmeye başlamıştım",
      "Sonunda. Polis olmayı istediğim günlere pişman oluyordum",
      "Sonunda. Polisimiz biraz yavaşlamış sanki"
    ]
  },

  {
    hasAny: ["dedektifim", "polis değil", "benim adım", "biz dedektifiz", "adımız", "adım"],
    replies: [
      "her neyse buradaysan dosyaya ulaşmışsın ve polisten iyisin demektir",
      "buradaysan dosyayı seninle paylaşmışlar demektir. yani polise yardım ediyorsun"
    ]
  },

  {
    hasAny: ["sen kimsin", "kimsin", "adın ne", "kiminle konuşuyorum", "adını söyle" ],
    sequence: [
    [
      "adımı bilmek sana davayı çözdürmeyecek",
      "o gece zülüfte olan birkaç kişiden biriyim",
      "kıymetimi bilirsen bu davanın en önemli tanığıyım"
    ],
    [
      "bu ilk ve son konuşmamız yani doğru soruları sormalısın",
    ]
   ]
  },

{
    hasAny: ["katil kim", "katili gördün mü", "katili biliyor musun", "katil sen misin" ],
    sequence: [
    [
      "katili yakalayın diye kendimi riske atıyorum",
      "katil bulunsun diye bunu  yapıyorum zaten"
    ],
    [
      "kim olduğunu bilmiyorum ama ben katil değilim",
      "katil kim bilmiyorum ama ben katil olsam burada olmazdım"
    ]
   ]
  },

  {
    hasAny: ["anlat", "ne biliyo", "ne oldu", "noldu", "ne gördün" ],
    sequence: [
    [
      "o gece kemal oğuz tarıkı inşaata kadar takip etmişti çünkü amacını öğrenmişti",
      "öncelikle kemal oğuz da olay saatinde oradaydı tarıkın onu ifşalayacağını öğrenmiş ve onu takip etmişti"
    ],
    [
      "ayrıca inşaata giren biri daha vardı karton toplama arabası olan orta yaşlı bir adam",
      "bir de orta yaşlı bir adam gördüm karton toplama arabasıyla inşaata giriyordu"
    ]
   ]
  },

  {
    hasAny: ["adam mı", "adam olduğuna emin misin", "kadın olması", "o kadındı", "yüzünü" ],
    replies: [
      "yüzünü göremedim ama bir kadın ve adamı ayırt edebilirim",
      "karanlıktı yüzünü seçemedim ama kesinlikle kadın değildi"
    ]
  },

  {
    hasAny: ["ne işin", "neden oradaydın", "neden zülüfteydin", "neden gittin", "sokakta mıydın" ],
    sequence: [
    [ 
      "hedefin ben değilim artık doğru yöne odaklan",
      "biliyorum çok şüpheliyim ama tek istediğim katilin bulunması"
    ],
    [
      "ama evet zülüfteydim"
    ]
   ]
  },

  {
    hasAny: ["başka", "sana nasıl inan", "sana nasıl güven", "sana neden güven", "sana niye inan", "sana neden inan" ],
    replies: [
      "alaz yapının ifşa haberini tarıkın isteği üzerine ben yaptım. hazırladığı usb'yi o gece tarıkın cansız bedeninden ellerimle aldım. yeterli mi?",
      "tarık o gece inşaata alaz yapının ifşa haberini yapmam için bana kanıt vermeye gelmişti. kanıtları aldım ama tarık ölmüştü."
    ]
  }
];

const nonsenseReplies=[
  "zamanımı boşa harcama",
  "doğru soruları sorman gerek",
  "Vaktimi seninle boşa mı harcıyorum?"
];

const turnTriggers = {
  1: ["kiminle konuşuyorum?"],
  3: ["ve fazla vaktimiz yok"],
  6: ["zamanımız tükeniyor"],
  8: ["son bir sorun varsa hemen sor"]
};

const statusEl=document.getElementById("status");
const typingEl=document.getElementById("typing");

let lastUserMessage="";
let offlineTimer=null;
let botTimers=[];

function rand(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

function setStatus(on){
  statusEl.textContent=on?"● online":"● offline";
  statusEl.className="status "+(on?"online":"offline");
}

function checkPassword(){

  const errorEl = document.getElementById("loginError");

  if (correctPasswords.includes(password.value.trim().toLowerCase())) {
    errorEl.style.display = "none";

    login.style.display = "none";
    loading.style.display = "block";

    setTimeout(()=>{
      loading.style.display = "none";
      content.style.display = "block";
      document.getElementById("exitFloating").style.display = "block";
    },3000);

  } else {
  wrongPasswordCount++;
  errorEl.style.display = "block";
  password.value = "";

  const riddleEl = document.getElementById("riddleText");

  let newLevel = 0;
  if (wrongPasswordCount >= 8) newLevel = 8;
  else if (wrongPasswordCount >= 5) newLevel = 5;
  else if (wrongPasswordCount >= 3) newLevel = 3;

  if (newLevel !== currentRiddleLevel) {
    currentRiddleLevel = newLevel;
    riddleEl.textContent = riddles[newLevel];
    riddleEl.style.fontSize = riddleSizes[newLevel];

    // sadece değişimde küçük bir geçiş
    riddleEl.style.opacity = "0";
    setTimeout(() => {
      riddleEl.style.opacity = "1";
    }, 200);

    // 8'den sonra tehdit rengi
    if (newLevel >= 8) {
      riddleEl.style.color = "#a33";
    }
  }
}
}

function addMessage(text,type){
  const d=document.createElement("div");
  d.className="message "+type;
  d.textContent=text;
  chat.insertBefore(d,typingEl);
  chat.scrollTop=chat.scrollHeight;
}

function delayedBot(text){
  typingEl.style.display="block";

  setTimeout(()=>{
    typingEl.style.display="none";
    addMessage(text,"bot");
    playBotSound();
  }, rand(900,1600));
clearTimeout(offlineTimer);
offlineTimer=setTimeout(()=>setStatus(false),rand(5000,8000));
}

function endOfTurn() {
  conversationTurn++;

  if (turnTriggers[conversationTurn]) {
    delayedBot(
      turnTriggers[conversationTurn][
        Math.floor(Math.random() * turnTriggers[conversationTurn].length)
      ]
    );
  }
}

function runMessageTrigger(count) {
  const lines = messageTriggers[count];
  if (!lines) return;

  const text = lines[Math.floor(Math.random() * lines.length)];

  setTimeout(() => {
    typingEl.style.display = "block";
    chat.scrollTop = chat.scrollHeight;

    setTimeout(() => {
      typingEl.style.display = "none";
      addMessage(text, "bot");
      playBotSound();
    }, rand(900, 1500));
  }, rand(700, 1200));
}

function sendMessage(){

if (connectionClosed) return;

  if (userMessageCount >= MAX_MESSAGES) return;

  const text=userInput.innerText.trim();
  if(!text) return;

  userInput.innerText="";
  addMessage(text,"user");
  playUserSound();

  lastUserMessage = text;
  userMessageCount++;
  updateCounter();

  clearTimeout(offlineTimer);
  botTimers.forEach(t=>clearTimeout(t));
  botTimers=[];

  const onlineDelay=rand(1000,2500);
  const typingDelay=rand(800,1500);
  const replyDelay=rand(1200,2500);

  botTimers.push(setTimeout(()=>setStatus(true),onlineDelay));
  
botTimers.push(setTimeout(()=>{
  typingEl.style.display = "block";
  chat.scrollTop = chat.scrollHeight;
}, onlineDelay + typingDelay));

  botTimers.push(setTimeout(()=>{
    typingEl.style.display="none";

    let matchedRule = null;
const lower = normalizeText(lastUserMessage);

for (const rule of dialogRules) {
  if (rule.hasAny && hasAny(lower, rule.hasAny)) {
    matchedRule = rule;
    break;
  }
}

if (matchedRule) {

  if (matchedRule.sequence) {
    typingEl.style.display = "block";
    chat.scrollTop = chat.scrollHeight;
    runSequence(matchedRule.sequence);
    return;
  }

  if (matchedRule.replies) {
    const reply =
      matchedRule.replies[Math.floor(Math.random() * matchedRule.replies.length)];

botIsSpeaking = true;

setTimeout(() => {
  botIsSpeaking = false;
  endOfTurn();
}, 1500);

    addMessage(reply, "bot");
    playBotSound();

  if (userMessageCount >= MAX_MESSAGES) {
  setTimeout(endConnection, 2500);
}

    runMessageTrigger(userMessageCount);

    offlineTimer = setTimeout(() => setStatus(false), rand(5000,8000));
    return;
  }
}

const fallback =
  nonsenseReplies[Math.floor(Math.random() * nonsenseReplies.length)];

addMessage(fallback, "bot");
playBotSound();

  if (userMessageCount >= MAX_MESSAGES) {
    setTimeout(endConnection, 2500);
  }


runMessageTrigger(userMessageCount);

    offlineTimer=setTimeout(()=>setStatus(false),rand(5000,8000));
  },onlineDelay+typingDelay+replyDelay));
}

/* MATRIX */
const canvas=document.getElementById("matrix");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

const chars="01#$%&*";
const fontSize=14;
let drops=Array(Math.floor(innerWidth/fontSize)).fill(1);

setInterval(()=>{
  ctx.fillStyle="rgba(0,0,0,0.08)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font=fontSize+"px monospace";
  ctx.fillStyle=Math.random()>0.97?"#a33":"#0f0";

  drops.forEach((y,i)=>{
    ctx.fillText(chars[Math.floor(Math.random()*chars.length)],i*fontSize,y*fontSize);
    if(y*fontSize>canvas.height&&Math.random()>0.98)drops[i]=0;
    drops[i]++;
  });
},120);

function endConnection(){
  setStatus(true); // son kez online görünsün

  const farewell =
    farewellMessages[Math.floor(Math.random() * farewellMessages.length)];

  typingEl.style.display = "block";
  chat.scrollTop = chat.scrollHeight;

  setTimeout(() => {
    typingEl.style.display = "none";
    addMessage(farewell, "bot");
    playBotSound();

    // veda sonrası kısa bir boşluk
    setTimeout(() => {
      setStatus(false);

      userInput.contentEditable = "false";
      userInput.style.opacity = "0.4";
      sendBtn.disabled = true;
      sendBtn.style.opacity = "0.4";

      counterEl.textContent = "0/" + MAX_MESSAGES;
      counterEl.style.color = "#a33";
    }, 1800);
  }, 1600);

 setTimeout(() => {
  setStatus(false);
 }, 3000);
}

</script>

<audio id="userSound" src="user.mp3"></audio>
<audio id="botSound" src="bot.mp3"></audio>

</body>
</html>